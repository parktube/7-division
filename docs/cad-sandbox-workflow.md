# CAD 샌드박스 코딩 워크플로우

> 시각적 피드백 환경에서 "동작하는 코드"에 만족하지 않고, 확장 가능한 설계를 유지하기 위한 가이드

## 문제 인식

### 탐색적 코딩의 함정

| 일반 코딩 | CAD 샌드박스 |
|----------|-------------|
| 요구사항 → 설계 → 구현 | 만들어보고 → 보고 → 수정 |
| 테스트가 검증 | 눈으로 검증 |
| 에러 메시지가 구체적 | "이상해 보이는데..." |
| 리팩토링 신호 명확 | 동작하면 "됐다" |

**핵심 문제**: 즉시 시각적 피드백이 "지금 동작하는 코드"에 집중하게 만들어 설계적 사고를 억제

## 워크플로우

### Phase 1: 설계 체크 (코딩 전)

```
새로운 기능 요청 받음
    ↓
┌─────────────────────────────────┐
│ 1. 유사한 코드가 이미 있는가?   │
│    → lsp({ operation: 'symbols', file: '...' }) │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 2. 확장인가, 신규인가?          │
│    - 확장: 기존 구조에 맞출 수 있나? │
│    - 신규: 나중에 비슷한 게 생길까?  │
└─────────────────────────────────┘
    ↓
사용자에게 "접근 방식" 먼저 제안
```

**예시:**
> "고양이를 추가하려고 합니다. Animal 클래스를 확장할 수 있지만, 꼬리 형태가 다릅니다.
> (1) Animal 수정 (2) 별도 함수 - 어떤 방식을 선호하시나요?"

### Phase 2: N번째 체크포인트

| 트리거 | 액션 |
|--------|------|
| 3번째 유사 함수 | "추상화 검토: 공통 패턴을 클래스/팩토리로?" |
| 2번째 땜질 수정 | "구조적 문제 신호 - 리팩토링 제안" |
| build() 후 파츠 수정 | "빌더 패턴이나 컴포지션 고려" |

**예시:**
> "세 번째 동물(고양이) 추가 시점입니다. 현재 Animal 클래스는 4족 기반입니다.
> 앞으로 닭, 뱀 등도 추가될 수 있을까요? 지금 구조를 검토할까요?"

### Phase 3: 동작 후 확장성 질문

```
capture로 시각 확인 완료
    ↓
┌─────────────────────────────────┐
│ "이 설계로 X를 추가하려면?"     │
│  - 코드 수정 없이 가능?         │
│  - 어디를 수정해야 하나?        │
└─────────────────────────────────┘
```

**예시:**
> "고양이 완성! 확장성 체크: '뱀'을 추가하려면 현재 구조로 가능할까요?"

### Phase 4: 땜질 2회 규칙

```
1번째 예외 처리: OK (합리적 예외)
2번째 예외 처리: 경고 ("패턴이 보입니다")
3번째 예외 처리: 중단 ("리팩토링 먼저 할까요?")
```

## 체크리스트

코딩 전:
- [ ] `lsp symbols`로 기존 유사 코드 확인
- [ ] 확장/신규 판단 → 접근 방식 사용자에게 제안

코딩 중:
- [ ] 3번째 유사 함수 → 추상화 검토
- [ ] 2번째 땜질 → 구조 재검토 제안

코딩 후:
- [ ] 동작 확인 후 "X 추가하려면?" 자문
- [ ] 확장 어려우면 리팩토링 제안

## 안티패턴

### 1. 즉시 구현
```
❌ "고양이 만들어줘" → 바로 코딩 시작
✅ "고양이 만들어줘" → 기존 Animal 구조 확인 → 방식 제안 → 코딩
```

### 2. 점진적 땜질
```
❌ 돼지 → 강아지(약간 수정) → 고양이(또 수정) → 닭(별도 함수)
✅ 돼지 → 강아지 → "3번째인데, 패턴 정리할까요?" → 구조 개선 → 고양이
```

### 3. 동작 = 완료
```
❌ capture 확인 → "됐다" → 다음
✅ capture 확인 → "뱀 추가 가능?" → 불가능하면 개선점 메모
```

## 좋은 샘플의 역할

워크플로우만으로는 부족합니다. **구체적인 샘플**이 필요합니다:

| 샘플 없을 때 | 샘플 있을 때 |
|-------------|-------------|
| "컴포지션으로 해" | "이 PartBuilder처럼 해" |
| 추상적 원칙 | 복사해서 수정 가능한 코드 |

### 권장 샘플 구조
```
modules/
├── animal_lib.js      ← 현재 (참고용)
├── parts_lib.js       ← 파츠 기반 컴포지션 예시
└── examples/
    ├── composition.js ← 컴포지션 패턴
    └── builder.js     ← 빌더 패턴
```

## 관련 문서

- `CLAUDE.md` - 도구 사용법
- `docs/ax-design-guide.md` - AX 설계 원칙
